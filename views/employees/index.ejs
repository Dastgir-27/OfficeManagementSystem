<% layout('layouts/boilerplate') %>


<div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Employees</h1>
    <a href="/employees/new" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Add New Employee
    </a>
</div>

<!-- Search and Filter Form -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <form method="GET" class="grid md:grid-cols-4 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
            <input type="text" name="search" value="<%= search %>" placeholder="Name or email..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
            <select name="department" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">All Departments</option>
                <% departments.forEach(dept => { %>
                    <option value="<%= dept._id %>" <%= selectedDepartment === dept._id.toString() ? 'selected' : '' %>>
                        <%= dept.name %>
                    </option>
                <% }) %>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Job Title</label>
            <select name="jobTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">All Job Titles</option>
                <% jobTitles.forEach(title => { %>
                    <option value="<%= title %>" <%= selectedJobTitle === title ? 'selected' : '' %>>
                        <%= title %>
                    </option>
                <% }) %>
            </select>
        </div>
        <div class="flex items-end">
            <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                Filter
            </button>
        </div>
    </form>
</div>

<!-- Results Summary -->
<div class="mb-4">
    <p class="text-gray-600">
        Showing <%= employees.length %> of <%= total %> employees
        <% if (search || selectedDepartment || selectedJobTitle) { %>
            - <a href="/employees" class="text-blue-600 hover:underline">Clear filters</a>
        <% } %>
    </p>
</div>

<!-- Employees Table -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Job Title</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Supervisor</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            <% employees.forEach(employee => { %>
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">
                            <%= employee.firstName %> <%= employee.lastName %>
                        </div>
                        <div class="text-sm text-gray-500"><%= employee.status %></div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <%= employee.email %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <%= employee.jobTitle %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <%= employee.department ? employee.department.name : 'N/A' %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <%= employee.supervisor ? employee.supervisor.firstName + ' ' + employee.supervisor.lastName : 'None' %>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                        <a href="/employees/<%= employee._id %>" class="text-blue-600 hover:text-blue-900">View</a>
                        <a href="/employees/<%= employee._id %>/edit" class="text-green-600 hover:text-green-900">Edit</a>
                        <form method="POST" action="/employees/<%= employee._id %>?_method=DELETE" class="inline">
                            <button type="submit" class="text-red-600 hover:text-red-900" 
                                    onclick="return confirm('Are you sure you want to delete this employee?')">Delete</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>
</div>

<!-- Pagination -->
<% if (totalPages > 1) { %>
    <div class="mt-6 flex justify-center">
        <nav class="flex space-x-2">
            <% if (currentPage > 1) { %>
                <a href="?page=<%= currentPage - 1 %>&search=<%= search %>&department=<%= selectedDepartment %>&jobTitle=<%= selectedJobTitle %>" 
                   class="px-3 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-500 hover:bg-gray-50 rounded">Previous</a>
            <% } %>
            
            <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                <a href="?page=<%= i %>&search=<%= search %>&department=<%= selectedDepartment %>&jobTitle=<%= selectedJobTitle %>" 
                   class="px-3 py-2 <%= i === currentPage ? 'bg-blue-600 text-white' : 'bg-white text-gray-500 hover:bg-gray-50' %> border border-gray-300 text-sm font-medium rounded">
                    <%= i %>
                </a>
            <% } %>
            
            <% if (currentPage < totalPages) { %>
                <a href="?page=<%= currentPage + 1 %>&search=<%= search %>&department=<%= selectedDepartment %>&jobTitle=<%= selectedJobTitle %>" 
                   class="px-3 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-500 hover:bg-gray-50 rounded">Next</a>
            <% } %>
        </nav>
    </div>
<% } %>
